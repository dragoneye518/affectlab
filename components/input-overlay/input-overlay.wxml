<view class="fixed inset-0 z-60 bg-dark-900-95 backdrop-blur flex flex-col p-6 animate-slide-in-bottom">
  <!-- Header -->
  <view class="flex justify-between items-center mb-6">
      <view class="text-xl font-bold text-white flex items-center gap-2">
          <image src="https://api.iconify.design/lucide:fingerprint.svg?color=%23ff00ff" class="w-5 h-5" />
          <text>{{template.id === 'custom-signal' ? '信号转译 (SIGNAL DECODE)' : '情绪注入'}}</text>
      </view>
      <view bindtap="onCancel" class="p-2 bg-white-10 rounded-full active-bg-white-20 transition-colors">
          <image src="https://api.iconify.design/lucide:x.svg?color=white" class="w-5 h-5" />
      </view>
  </view>
  
  <scroll-view scroll-y show-scrollbar="false" enable-flex class="flex-1 flex flex-col gap-4 pb-8" style="display: flex; flex-direction: column;">
      <!-- Template Info -->
      <view class="flex items-center gap-3 p-3 bg-white-5 rounded-xl border border-white-10">
          <image src="{{template.imageUrl}}" class="w-12 h-12 rounded-lg object-cover" />
          <view>
              <view class="text-sm font-bold text-white">{{template.title}}</view>
              <view class="text-xs text-gray-400 flex items-center gap-1">
                  消耗 {{template.cost}} 
                  <image src="https://api.iconify.design/lucide:candy.svg?color=white" class="w-3 h-3" />
              </view>
          </view>
      </view>

      <!-- Quick Prompts -->
      <block wx:if="{{!polishOptions && template.quickPrompts && template.quickPrompts.length > 0}}">
          <view class="flex flex-wrap gap-2 mb-2">
              <block wx:for="{{template.quickPrompts}}" wx:key="*this">
                  <view
                      bindtap="onQuickPrompt"
                      data-text="{{item}}"
                      class="text-xs bg-neon-blue-10 text-neon-blue border border-neon-blue-30 px-3 py-1-5 rounded-full active-bg-neon-blue-30 transition-colors"
                  >
                      {{item}}
                  </view>
              </block>
          </view>
      </block>

      <!-- AI Options -->
      <block wx:if="{{polishOptions}}">
          <view class="space-y-2 mb-2 animate-fade-in">
              <view class="text-xs text-neon-green font-bold flex items-center gap-1">
                  <image src="https://api.iconify.design/lucide:sparkles.svg?color=%2300ff00" class="w-3 h-3" />
                  <text>DECODED SIGNALS (Select one):</text>
              </view>
              <block wx:for="{{polishOptions}}" wx:key="index">
                  <view
                      bindtap="onSelectOption"
                      data-text="{{item.text}}"
                      class="w-full text-left p-3 rounded-xl bg-gradient-option border border-white-10 active-scale-98"
                  >
                      <text class="text-xs-mini font-black uppercase px-1-5 py-0-5 rounded mr-2 {{item.style === 'TOXIC' ? 'bg-red-500' : (item.style === 'EMO' ? 'bg-blue-500' : 'bg-purple-500')}} text-white">{{item.style}}</text>
                      <text class="text-sm text-white">{{item.text}}</text>
                  </view>
              </block>
          </view>
      </block>

      <!-- Switch Recommendation -->
      <block wx:if="{{recommendedId && recommendedTemplateName}}">
          <view class="p-3 rounded-xl bg-neon-pink-10 border border-neon-pink-30 flex items-center justify-between animate-zoom-in">
              <view class="flex flex-col">
                  <text class="text-xs-mini text-neon-pink font-bold uppercase">Signal Matched</text>
                  <text class="text-sm font-bold text-white">Switch to: {{recommendedTemplateName}}?</text>
              </view>
              <view 
                  bindtap="onSwitch"
                  class="bg-neon-pink text-white text-xs font-bold px-3 py-2 rounded-lg flex items-center gap-1 active-scale-95"
              >
                  Switch <image src="https://api.iconify.design/lucide:arrow-right-circle.svg?color=white" class="w-3 h-3" />
              </view>
          </view>
      </block>

      <!-- Input Area -->
      <view class="relative flex-1 min-h-120">
          <view class="flex justify-between items-center mb-2">
              <text class="block text-gray-500 text-xs font-mono uppercase tracking-wider">Subject Input &gt;_</text>
              <!-- Magic Polish Button -->
              <view 
                  bindtap="handleAIPolish"
                  class="flex items-center gap-1 text-xs px-2 py-1 rounded-full border transition-all {{!input ? 'opacity-50 border-transparent text-gray-500' : 'border-neon-purple-50 text-neon-purple bg-neon-purple-10'}}"
              >
                  <image src="https://api.iconify.design/lucide:wand-2.svg?color=%23bf00ff" class="w-3 h-3 {{isPolishing ? 'animate-spin' : ''}}" />
                  <text>{{isPolishing ? "DECODING..." : "AI 信号转译"}}</text>
              </view>
          </view>
          
          <textarea
              class="w-full h-40 bg-black border rounded-xl p-4 text-white text-base {{isFocused ? 'border-neon-blue' : 'border-neon-blue-30'}}"
              placeholder="{{template.id === 'custom-signal' ? '输入你的任何情绪 (如: 不想上班, 前任找我)...' : template.inputHint}}"
              placeholder-class="text-gray-600"
              value="{{input}}"
              focus="{{shouldFocus}}"
              cursor-spacing="20"
              bindinput="onInput"
              bindfocus="onFocus"
              bindblur="onBlur"
              maxlength="50"
          ></textarea>
          <view class="text-right text-xs text-gray-500 mt-2">
              {{input.length}}/50
          </view>
      </view>

      <!-- Animation Overlay for Submit -->
      <block wx:if="{{isAnimating}}">
          <view class="absolute top-1-2 left-1-2 -translate-x-1-2 -translate-y-1-2 z-50 flex flex-col items-center animate-fade-out">
              <image src="https://api.iconify.design/lucide:candy.svg?color=%23ff00ff" class="w-12 h-12 mb-2" />
              <text class="text-3xl font-black text-white text-shadow-neon">-{{template.cost}}</text>
          </view>
      </block>

      <button 
          bindtap="handleConfirm"
          disabled="{{isAnimating}}"
          class="btn-neon-glow w-full bg-gradient-pink-purple text-white py-4 rounded-xl font-bold text-lg shadow-neon-pink active-scale-95 flex items-center justify-center gap-2 {{isAnimating ? 'scale-95 opacity-50' : ''}}"
      >
          <block wx:if="{{isAnimating}}">
              <image src="https://api.iconify.design/lucide:zap.svg?color=white" class="w-5 h-5 animate-spin" />
              <text>TRANSMITTING...</text>
          </block>
          <block wx:else>
              <image src="https://api.iconify.design/lucide:zap.svg?color=white" class="w-5 h-5" />
              <text>开始生成</text>
          </block>
      </button>
      <view class="h-10"></view>
  </scroll-view>
</view>
